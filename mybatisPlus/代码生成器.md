# 配置类

## SuperGenerator

```java
@Configuration
@ConditionalOnExpression("${vp.generator.enable:false}")
public class SuperGenerator {

    private static String driver;
    private static String url;
    private static String username;
    private static String password;

    @Value("${spring.datasource.driver-class-name}")
    public void setDriver(String driver) {
        SuperGenerator.driver = driver;
    }

    @Value("${spring.datasource.url}")
    public void setUrl(String url) {
        SuperGenerator.url = url;
    }

    @Value("${spring.datasource.username}")
    public void setUsername(String username) {
        SuperGenerator.username = username;
    }

    @Value("${spring.datasource.password}")
    public void setPassword(String password) {
        SuperGenerator.password = password;
    }

     /**
     * 配置GlobalConfig
     * @return GlobalConfig
     */
    protected GlobalConfig getGlobalConfig() {
        return new GlobalConfig()
                // 设置输出目录
                .setOutputDir(getJavaPath())
            	//是否覆盖已有文件，默认false
                .setFileOverride(false)
            	//是否打开输出目录，默认
            	.setOpen(false)
            	//是否开启ActiveRecord 模式，局限性大，一般只在单表操作使用
                .setActiveRecord(false)
            	//是否在xml中添加二级缓存配置，默认false
                .setEnableCache(false)
                .setBaseResultMap(false)
                .setBaseColumnList(false)
            	//开启Kotlin模式，默认false
                .setKotlin(false)
                .setIdType(IdType.AUTO)
            	//数据库时间类型 到 实体类时间类型 对应策略
                .setDateType(DateType.ONLY_DATE)
                .setAuthor(CustomConfig.getAuthor())
                // 自定义文件命名，注意%s 会自动填充表实体属性
                .setEntityName("%s")
                .setMapperName("%sMapper")
                .setXmlName("%sMapper")
                .setServiceName("%sService")
                .setServiceImplName("%sServiceImpl")
                .setControllerName("%sController");
    }

    /**
     * 配置DataSourceConfig
     * @return DataSourceConfig
     */
    protected DataSourceConfig getDataSourceConfig() {
        return new DataSourceConfig()
                // 设置数据库类型
                .setDbType(DbType.MYSQL)
            	//自定义类型转换（可以自己配置）
                .setTypeConvert(new MySqlTypeConvert() {
                    @Override
                    public IColumnType processTypeConvert(GlobalConfig globalConfig, String fieldType) {
                        String bit = "bit", tinyint = "tinyint", date = "date", time = "time", datetime = "datetime";
                        if (bit.equals(fieldType.toLowerCase())) {
                            return DbColumnType.BOOLEAN;
                        }
                        if (tinyint.equals(fieldType.toLowerCase())) {
                            return DbColumnType.BOOLEAN;
                        }
                        if (date.equals(fieldType.toLowerCase())) {
                            return DbColumnType.LOCAL_DATE;
                        }
                        if (time.equals(fieldType.toLowerCase())) {
                            return DbColumnType.LOCAL_TIME;
                        }
                        if (datetime.equals(fieldType.toLowerCase())) {
                            return DbColumnType.LOCAL_DATE_TIME;
                        }
                        return super.processTypeConvert(globalConfig, fieldType);
                    }
                })
                .setDriverName(driver)
                .setUsername(username)
                .setPassword(password)
                .setUrl(url);
    }

    /**
     * 自定义模板
     * customize template engine
     * @return TemplateConfig
     */
    protected TemplateConfig getCustomizeTemplateEngine() {
        return new TemplateConfig().setXml(null);
    }

    /**
     * customize attribute inject
     * @return InjectionConfig
     */
    protected InjectionConfig getInjectionConfig() {
        return new InjectionConfig() {
            @Override
            public void initMap() {
                Map<String, Object> map = Maps.newHashMap();
                map.put("datetime", new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date()));
                this.setMap(map);
            }
        }.setFileOutConfigList(Collections.singletonList(
                new FileOutConfig("/templates/mapper.xml.vm") {
            @Override
            public String outputFile(TableInfo tableInfo) {
                return getJavaPath() + "/mapper/" + tableInfo.getEntityName() + "Mapper.xml";
            }
        }));
    }

    /**
     * strategy config 策略配置
     * @param tableName
     * @return
     */
        protected StrategyConfig getStrategyConfig(String tableName) {
        List<TableFill> tableFillList = getTableFills();
        System.out.println(CustomConfig.getTablePrefix());
        return new StrategyConfig()
                // 全局大写命名
                .setCapitalMode(false)
                // 去除前缀
                .setTablePrefix(CustomConfig.getTablePrefix())
                // 表名生成策略
                .setNaming(NamingStrategy.underline_to_camel)
                // 自定义实体父类
                .setSuperEntityClass("com.sucsoft.video.framework.model.BaseModel")
                // 自定义实体公共字段
                .setSuperEntityColumns("id")
                .setTableFillList(tableFillList)
                // 自定义mapper父类  例如"com.sucsoft.video.framework.model.BaseModel"
                .setSuperMapperClass("全限定名")
                // 自定义 controller 父类
                .setSuperControllerClass("全限定名")
                // 自定义 service 实现类父类
                .setSuperServiceImplClass("全限定名")
                // 自定义 service 接口父类
                .setSuperServiceClass("全限定名")
                // 【实体】 是否生成字段常量
                .setEntityColumnConstant(true)
                // 【实体】 是否为构建者模型
                .setEntityBuilderModel(false)
                // 【实体】 是否为lombok模型
                .setEntityLombokModel(true)
                // Boolean类型字段是否移除is前缀处理
                .setEntityBooleanColumnRemoveIsPrefix(true)
                .setRestControllerStyle(true)
                .setInclude(tableName);
    }

    /**
     * strategy of tablefill
     * @return
     */
    protected List<TableFill> getTableFills() {
        List<TableFill> tableFillList = Lists.newArrayList();
        tableFillList.add(new TableFill("createTime", FieldFill.INSERT));
        tableFillList.add(new TableFill("updateTime", FieldFill.INSERT_UPDATE));
        tableFillList.add(new TableFill("createUid", FieldFill.INSERT));
        tableFillList.add(new TableFill("updateUid", FieldFill.INSERT_UPDATE));
        return tableFillList;
    }

    /**
     * get packageConfig
     * @return PackageConfig
     */
    protected PackageConfig getPackageConfig() {
        return new PackageConfig()
                .setParent(CustomConfig.getParent())
                .setController("controller")
                .setEntity("bean")
                .setMapper("mapper")
                .setService("service")
                .setServiceImpl("service.impl");
    }

    /**
     * Get the javaPath directory
     * @return String
     */
    private String getJavaPath() {
        System.out.println(Objects.requireNonNull(SuperGenerator.class.getClassLoader().getResource("")).getPath());
        return Objects.requireNonNull(SuperGenerator.class.getClassLoader().getResource("")).getPath();
    }

    /**
     * get autoGenerator
     * @param tableName
     * @return
     */
    protected AutoGenerator getAutoGenerator(String tableName) {
        return new AutoGenerator()
                // global config
                .setGlobalConfig(getGlobalConfig())
                // dataSource
                .setDataSource(getDataSourceConfig())
                // strategy config
                .setStrategy(getStrategyConfig(tableName))
                // package config
                .setPackageInfo(getPackageConfig())
                .setCfg(getInjectionConfig())
                .setTemplate(getCustomizeTemplateEngine());
    }
}

```

## 子类MysqlGenerator

```java
@Slf4j
public class MysqlGenerator extends SuperGenerator {

    /**
     * mysql generator
     * @param tableName 表名
     */
    public void generator(String tableName) {
        AutoGenerator mpg = getAutoGenerator(tableName);
        mpg.execute();
        if (tableName == null) {
            log.info(" Generator Success !");
        } else {
            log.info(" TableName【 " + tableName + " 】Generator Success");
        }
    }
}

```

## 参数配置类CustomConfig

```java
@Configuration
@ConfigurationProperties(prefix = "mybatis-plus")
public class CustomConfig {

    private static String author;

    private static String tablePrefix;

    private static String parent;

    public static String getAuthor() {
        return author;
    }

    public static String getTablePrefix() {
        return tablePrefix;
    }

    public static String getParent() {
        return parent;
    }

    @Value("${mybatis-plus.author:nobody}")
    public void setAuthor(String author) {
        CustomConfig.author = author;
    }

    @Value("${mybatis-plus.tablePrefix:sys_}")
    public void setTablePrefix(String tablePrefix) {
        CustomConfig.tablePrefix = tablePrefix;
    }

    @Value("${mybatis-plus.parent:com.sucsoft.dist}")
    public void setParent(String parent) {
        CustomConfig.parent = parent;
    }
}

```

